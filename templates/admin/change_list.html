{% extends "admin/base.html" %}
{% load i18n admin_urls static admin_list l10n %}

{% block title %}{{ title }} | {{ site_title|default:_("Django site admin") }}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .changelist-search {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .changelist-search .form-row {
            display: flex;
            gap: 1rem;
            align-items: end;
        }
        
        .changelist-search input[type="text"] {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .changelist-search input[type="submit"] {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .changelist-search input[type="submit"]:hover {
            background-color: var(--primary-dark);
        }
        
        .changelist-filter {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .changelist-filter h2 {
            background: var(--light-bg);
            padding: 1rem 1.5rem;
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            border-bottom: 1px solid var(--border-color);
        }
        
        .changelist-filter h3 {
            font-size: 0.875rem;
            font-weight: 600;
            margin: 1rem 1.5rem 0.5rem 1.5rem;
            color: var(--text-primary);
        }
        
        .changelist-filter ul {
            list-style: none;
            padding: 0;
            margin: 0 1.5rem 1rem 1.5rem;
        }
        
        .changelist-filter li {
            margin: 0.25rem 0;
        }
        
        .changelist-filter a {
            color: var(--text-secondary);
            text-decoration: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            display: block;
            transition: all 0.2s ease;
        }
        
        .changelist-filter a:hover,
        .changelist-filter a.selected {
            background-color: var(--primary-color);
            color: white;
        }
        
        .changelist-actions {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .changelist-actions .actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .changelist-actions select {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        
        .changelist-actions .action-button {
            background-color: var(--warning-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .changelist-actions .action-button:hover {
            background-color: #b45309;
        }
        
        .add-button {
            background-color: var(--success-color);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .add-button:hover {
            background-color: #047857;
            color: white;
            text-decoration: none;
        }
        
        .results {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .results table {
            width: 100%;
            margin: 0;
            border-collapse: collapse;
        }
        
        .results thead th {
            background: var(--light-bg);
            padding: 1rem;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
            text-align: left;
            position: relative;
        }
        
        .results thead th a {
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .results thead th a:hover {
            color: var(--primary-color);
        }
        
        .results thead th.sorted {
            background: var(--primary-color);
            color: white;
        }
        
        .results thead th.sorted a {
            color: white;
        }
        
        .results tbody td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }
        
        .results tbody tr:hover {
            background-color: var(--light-bg);
        }
        
        .results tbody tr.selected {
            background-color: rgba(37, 99, 235, 0.1);
        }
        
        .results .action-checkbox {
            width: 40px;
            text-align: center;
        }
        
        .results .action-checkbox input[type="checkbox"] {
            transform: scale(1.2);
        }
        
        .results .action-select {
            width: 60px;
            text-align: center;
        }
        
        .results .nowrap {
            white-space: nowrap;
        }
        
        .paginator {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem 1.5rem;
            margin-top: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .paginator .pagination {
            display: flex;
            gap: 0.25rem;
            margin: 0;
        }
        
        .paginator .pagination a,
        .paginator .pagination span {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }
        
        .paginator .pagination a:hover {
            background-color: var(--light-bg);
            border-color: var(--primary-color);
        }
        
        .paginator .pagination .current {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .paginator .pagination .disabled {
            color: var(--text-secondary);
            cursor: not-allowed;
        }
        
        .object-tools {
            margin-bottom: 1.5rem;
        }
        
        .object-tools ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            gap: 0.5rem;
        }
        
        .object-tools li {
            margin: 0;
        }
        
        .object-tools a {
            background-color: var(--success-color);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .object-tools a:hover {
            background-color: #047857;
            color: white;
        }
        
        .empty-changelist {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }
        
        .empty-changelist i {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .status-badge.active {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-badge.inactive {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        
        .status-badge.featured {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        .tech-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        
        .tech-tag {
            background-color: var(--light-bg);
            color: var(--text-primary);
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            border: 1px solid var(--border-color);
        }
        
        @media (max-width: 768px) {
            .changelist-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .changelist-actions .actions {
                justify-content: center;
            }
            
            .results table {
                font-size: 0.875rem;
            }
            
            .results thead th,
            .results tbody td {
                padding: 0.75rem 0.5rem;
            }
            
            .paginator {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
{% endblock %}

{% block content %}
<div class="content-header">
    <h2>
        <i class="fas fa-list me-2"></i>
        {{ title }}
    </h2>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">Dashboard</a></li>
            <li class="breadcrumb-item active">{{ opts.verbose_name_plural|capfirst }}</li>
        </ol>
    </nav>
</div>

{% block object-tools %}
    {% if has_add_permission %}
        <div class="object-tools">
            <ul>
                <li>
                    <a href="{% url cl.opts|admin_urlname:'add' %}{% if is_popup %}?{{ is_popup }}{% endif %}" class="addlink">
                        <i class="fas fa-plus"></i>
                        Adicionar {{ opts.verbose_name }}
                    </a>
                </li>
            </ul>
        </div>
    {% endif %}
{% endblock %}

{% if cl.search_fields %}
    <div class="changelist-search">
        <form method="get">
            <div class="form-row">
                <label for="searchbar"><i class="fas fa-search me-2"></i>Buscar:</label>
                <input type="text" size="40" name="{{ search_var }}" value="{{ cl.query }}" id="searchbar" autofocus>
                <input type="submit" value="Buscar">
                {% if cl.query %}
                    <a href="?" class="btn btn-outline-secondary">
                        <i class="fas fa-times"></i> Limpar
                    </a>
                {% endif %}
            </div>
            {% for k, v in cl.params.items %}
                {% if k != search_var %}
                    <input type="hidden" name="{{ k }}" value="{{ v }}">
                {% endif %}
            {% endfor %}
        </form>
    </div>
{% endif %}

{% if cl.has_filters %}
    <div class="changelist-filter">
        <h2><i class="fas fa-filter me-2"></i>Filtros</h2>
        {% for spec in cl.filter_specs %}
            {% admin_list_filter cl spec %}
        {% endfor %}
    </div>
{% endif %}

{% if action_form and actions_on_top and cl.show_admin_actions %}
    <div class="changelist-actions">
        <div class="actions">
            <label for="action-toggle">Ação:</label>
            <select name="action" id="action-select">
                <option value="" selected>---------</option>
                {% for choice in action_form.action.field.choices %}
                    <option value="{{ choice.0 }}">{{ choice.1|capfirst }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="action-button" title="Executar ação selecionada" name="index" value="{{ action_index }}">
                <i class="fas fa-play me-1"></i>Executar
            </button>
        </div>
        
        {% if cl.result_count %}
            <div class="result-count">
                <strong>{{ cl.result_count }}</strong> {{ cl.result_count|pluralize:"resultado,resultados" }}
                {% if cl.full_result_count != cl.result_count %}
                    ({{ cl.full_result_count }} total)
                {% endif %}
            </div>
        {% endif %}
    </div>
{% endif %}

<div class="results">
    {% if cl.result_list %}
        <table>
            <thead>
                <tr>
                    {% if action_form and cl.show_admin_actions %}
                        <th scope="col" class="action-checkbox">
                            <input type="checkbox" id="action-toggle">
                        </th>
                    {% endif %}
                    {% for header in result_headers %}
                        <th scope="col" {{ header.class_attrib }}>
                            {% if header.sortable %}
                                {% if header.sort_priority > 0 %}
                                    <a href="{{ header.url_primary }}" class="sorted">
                                        {{ header.text|capfirst }}
                                        {% if header.ascending %}
                                            <i class="fas fa-sort-up"></i>
                                        {% else %}
                                            <i class="fas fa-sort-down"></i>
                                        {% endif %}
                                    </a>
                                {% else %}
                                    <a href="{{ header.url_primary }}">
                                        {{ header.text|capfirst }}
                                        <i class="fas fa-sort"></i>
                                    </a>
                                {% endif %}
                            {% else %}
                                {{ header.text|capfirst }}
                            {% endif %}
                        </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                    <tr class="{% cycle 'row1' 'row2' %}{% if result.form and result.form.non_field_errors %} errornote{% endif %}">
                        {% if action_form and cl.show_admin_actions %}
                            <td class="action-checkbox">
                                {% if result.form %}
                                    {{ result.form.action }}
                                {% else %}
                                    <input type="checkbox" name="{{ action_form.action.html_name }}" value="{{ result.pk|unlocalize }}" class="action-select">
                                {% endif %}
                            </td>
                        {% endif %}
                        {% for item in result %}
                            {{ item }}
                        {% endfor %}
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="empty-changelist">
            <i class="fas fa-inbox"></i>
            <h3>Nenhum {{ opts.verbose_name }} encontrado</h3>
            <p>{% if cl.query %}Sua busca não retornou resultados.{% else %}Ainda não há {{ opts.verbose_name_plural }} cadastrados.{% endif %}</p>
            {% if has_add_permission %}
                <a href="{% url cl.opts|admin_urlname:'add' %}" class="add-button">
                    <i class="fas fa-plus"></i>
                    Adicionar {{ opts.verbose_name }}
                </a>
            {% endif %}
        </div>
    {% endif %}
</div>

{% if cl.result_list and is_paginated %}
    <div class="paginator">
        <div class="pagination-info">
            Página {{ page_num }} de {{ num_pages }}
            ({{ cl.result_count }} {{ cl.result_count|pluralize:"resultado,resultados" }})
        </div>
        
        <div class="pagination">
            {% if cl.result_list.has_previous %}
                <a href="?{% if cl.query %}{{ search_var }}={{ cl.query }}&{% endif %}p={{ cl.result_list.previous_page_number }}{{ cl.get_query_string }}" class="prev">
                    <i class="fas fa-chevron-left"></i> Anterior
                </a>
            {% else %}
                <span class="disabled">
                    <i class="fas fa-chevron-left"></i> Anterior
                </span>
            {% endif %}
            
            {% for page in page_range %}
                {% if page == '.' %}
                    <span class="disabled">…</span>
                {% elif page == page_num %}
                    <span class="current">{{ page }}</span>
                {% else %}
                    <a href="?{% if cl.query %}{{ search_var }}={{ cl.query }}&{% endif %}p={{ page }}{{ cl.get_query_string }}">{{ page }}</a>
                {% endif %}
            {% endfor %}
            
            {% if cl.result_list.has_next %}
                <a href="?{% if cl.query %}{{ search_var }}={{ cl.query }}&{% endif %}p={{ cl.result_list.next_page_number }}{{ cl.get_query_string }}" class="next">
                    Próxima <i class="fas fa-chevron-right"></i>
                </a>
            {% else %}
                <span class="disabled">
                    Próxima <i class="fas fa-chevron-right"></i>
                </span>
            {% endif %}
        </div>
    </div>
{% endif %}

<script>
// Funcionalidade para seleção em massa
document.addEventListener('DOMContentLoaded', function() {
    const toggleAll = document.getElementById('action-toggle');
    const checkboxes = document.querySelectorAll('.action-select');
    
    if (toggleAll) {
        toggleAll.addEventListener('change', function() {
            checkboxes.forEach(function(checkbox) {
                checkbox.checked = toggleAll.checked;
                const row = checkbox.closest('tr');
                if (checkbox.checked) {
                    row.classList.add('selected');
                } else {
                    row.classList.remove('selected');
                }
            });
        });
    }
    
    checkboxes.forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            const row = this.closest('tr');
            if (this.checked) {
                row.classList.add('selected');
            } else {
                row.classList.remove('selected');
            }
            
            // Atualizar o estado do checkbox principal
            const checkedCount = document.querySelectorAll('.action-select:checked').length;
            if (toggleAll) {
                toggleAll.checked = checkedCount === checkboxes.length;
                toggleAll.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
            }
        });
    });
});
</script>
{% endblock %}