{% extends "admin/base.html" %}
{% load i18n admin_urls static %}

{% block title %}Confirmar exclusão | {{ site_title|default:_("Django site admin") }}{% endblock %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .delete-confirmation {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--danger-color);
        }
        
        .delete-warning {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .delete-warning h3 {
            color: var(--danger-color);
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .delete-warning p {
            color: #991b1b;
            margin: 0;
            line-height: 1.6;
        }
        
        .object-info {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .object-info h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 1rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .object-details {
            display: grid;
            gap: 0.75rem;
        }
        
        .object-detail {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .object-detail:last-child {
            border-bottom: none;
        }
        
        .object-detail strong {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .object-detail span {
            color: var(--text-secondary);
        }
        
        .related-objects {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .related-objects h4 {
            background: #fff3cd;
            color: #856404;
            padding: 1rem 1.5rem;
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            border-bottom: 1px solid #ffeaa7;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .related-objects ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .related-objects li {
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .related-objects li:last-child {
            border-bottom: none;
        }
        
        .related-objects li i {
            color: var(--warning-color);
        }
        
        .action-buttons {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .btn-delete {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn-delete:hover {
            background-color: #b91c1c;
            color: white;
            text-decoration: none;
        }
        
        .btn-cancel {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .btn-cancel:hover {
            background-color: #475569;
            color: white;
            text-decoration: none;
        }
        
        .confirmation-checkbox {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .confirmation-checkbox label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
        }
        
        .confirmation-checkbox input[type="checkbox"] {
            transform: scale(1.2);
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn-delete,
            .btn-cancel {
                justify-content: center;
            }
            
            .object-detail {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
        }
    </style>
{% endblock %}

{% block content %}
<div class="content-header">
    <h2>
        <i class="fas fa-trash me-2"></i>
        Confirmar Exclusão
    </h2>
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a></li>
            <li class="breadcrumb-item"><a href="{% url opts|admin_urlname:'change' object.pk|admin_urlquote %}">{{ object|truncatewords:"18" }}</a></li>
            <li class="breadcrumb-item active">Excluir</li>
        </ol>
    </nav>
</div>

<div class="delete-warning">
    <h3>
        <i class="fas fa-exclamation-triangle"></i>
        Atenção: Esta ação não pode ser desfeita!
    </h3>
    <p>
        Você está prestes a excluir o {{ opts.verbose_name }} "<strong>{{ object|escape }}</strong>".
        {% if perms_lacking %}
            Você não tem permissão para excluir este objeto.
        {% else %}
            Esta ação é permanente e não pode ser revertida.
        {% endif %}
    </p>
</div>

<div class="object-info">
    <h4>
        <i class="fas fa-info-circle"></i>
        Informações do Objeto
    </h4>
    <div class="object-details">
        <div class="object-detail">
            <strong>Tipo:</strong>
            <span>{{ opts.verbose_name|capfirst }}</span>
        </div>
        <div class="object-detail">
            <strong>Identificação:</strong>
            <span>{{ object|escape }}</span>
        </div>
        {% if object.pk %}
        <div class="object-detail">
            <strong>ID:</strong>
            <span>{{ object.pk }}</span>
        </div>
        {% endif %}
        {% if object.data_criacao %}
        <div class="object-detail">
            <strong>Data de Criação:</strong>
            <span>{{ object.data_criacao|date:"d/m/Y H:i" }}</span>
        </div>
        {% endif %}
    </div>
</div>

{% if deleted_objects %}
    <div class="related-objects">
        <h4>
            <i class="fas fa-link"></i>
            Objetos Relacionados que Serão Excluídos
        </h4>
        <ul>
            {% for deletable_object in deleted_objects %}
                <li>
                    <i class="fas fa-arrow-right"></i>
                    {{ deletable_object|escape }}
                </li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

{% if perms_lacking %}
    <div class="alert alert-danger">
        <h4><i class="fas fa-ban me-2"></i>Permissões Insuficientes</h4>
        <p>Você não tem permissão para excluir este {{ opts.verbose_name }}.</p>
        <ul>
            {% for obj in perms_lacking %}
                <li>{{ obj }}</li>
            {% endfor %}
        </ul>
    </div>
    
    <div class="action-buttons">
        <div></div>
        <a href="{% url opts|admin_urlname:'change' object.pk|admin_urlquote %}" class="btn-cancel">
            <i class="fas fa-arrow-left"></i>
            Voltar
        </a>
    </div>
{% else %}
    <form method="post">
        {% csrf_token %}
        
        <div class="confirmation-checkbox">
            <label>
                <input type="checkbox" id="confirm-delete" required>
                Eu entendo que esta ação é irreversível e confirmo a exclusão
            </label>
        </div>
        
        <div class="action-buttons">
            <a href="{% url opts|admin_urlname:'change' object.pk|admin_urlquote %}" class="btn-cancel">
                <i class="fas fa-times"></i>
                Cancelar
            </a>
            
            <button type="submit" class="btn-delete" id="delete-button" disabled>
                <i class="fas fa-trash"></i>
                Sim, excluir {{ opts.verbose_name }}
            </button>
        </div>
    </form>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmCheckbox = document.getElementById('confirm-delete');
    const deleteButton = document.getElementById('delete-button');
    
    if (confirmCheckbox && deleteButton) {
        confirmCheckbox.addEventListener('change', function() {
            deleteButton.disabled = !this.checked;
            
            if (this.checked) {
                deleteButton.style.opacity = '1';
                deleteButton.style.cursor = 'pointer';
            } else {
                deleteButton.style.opacity = '0.5';
                deleteButton.style.cursor = 'not-allowed';
            }
        });
        
        // Adicionar confirmação extra no submit
        deleteButton.addEventListener('click', function(e) {
            if (!confirm('Tem certeza absoluta de que deseja excluir este item? Esta ação não pode ser desfeita.')) {
                e.preventDefault();
            } else {
                // Adicionar loading state
                this.innerHTML = '<div class="spinner"></div> Excluindo...';
                this.disabled = true;
            }
        });
    }
});
</script>
{% endblock %}