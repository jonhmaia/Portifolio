{% load static %}
{% load tailwind_tags %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" class="{% if request.LANGUAGE_CODE == 'ar' %}rtl{% endif %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% trans "Meu Portfólio" %}{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    {% tailwind_css %}
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/flags.css' %}">
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="{% url 'core:home' %}" class="text-xl font-bold text-blue-600 dark:text-blue-400">
                        {% trans "Meu Portfólio" %}
                    </a>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-4">
                    <!-- Lightsaber Theme Toggle -->
                    <div class="lightsaber-container">
                        <div class="lightsaber-toggle">
                            <input type="checkbox" id="saber-checkbox-desktop">
                            <div class="hilt"></div>
                            <div class="plasma"></div>
                        </div>
                    </div>
                    
                    <a href="{% url 'core:home' %}" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400">
                        {% trans "Home" %}
                    </a>
                    <a href="{% url 'core:curriculum' %}" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400">
                        {% trans "Currículo" %}
                    </a>
                    <a href="{% url 'portfolio:projects' %}" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400">
                        {% trans "Projetos" %}
                    </a>
                    <a href="{% url 'blog:articles' %}" class="text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400">
                        {% trans "Blog" %}
                    </a>
                    
                    <!-- Language Selector Buttons -->
                    <div class="flex items-center space-x-2">
                        <button id="lang-btn-pt" class="language-btn flex items-center px-3 py-1 rounded-lg transition-colors {% if LANGUAGE_CODE == 'pt-br' %}bg-blue-600 text-white{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600{% endif %}" data-lang="pt-br">
                            <span class="flag-icon flag-br mr-2"></span>
                            <span class="text-sm">PT</span>
                        </button>
                        <button id="lang-btn-en" class="language-btn flex items-center px-3 py-1 rounded-lg transition-colors {% if LANGUAGE_CODE == 'en' %}bg-blue-600 text-white{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600{% endif %}" data-lang="en">
                            <span class="flag-icon flag-us mr-2"></span>
                            <span class="text-sm">EN</span>
                        </button>
                    </div>
                </div>
                
                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center space-x-2">
                    <!-- Mobile Lightsaber Theme Toggle -->
                    <div class="lightsaber-container mobile-saber">
                        <div class="lightsaber-toggle">
                            <input type="checkbox" id="saber-checkbox-mobile">
                            <div class="hilt"></div>
                            <div class="plasma"></div>
                        </div>
                    </div>
                    
                    <!-- Hamburger Button -->
                    <button id="mobile-menu-toggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path class="hamburger-line" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                            <path class="close-line hidden" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <a href="{% url 'core:home' %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md">
                        {% trans "Home" %}
                    </a>
                    <a href="{% url 'core:curriculum' %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md">
                        {% trans "Currículo" %}
                    </a>
                    <a href="{% url 'portfolio:projects' %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md">
                        {% trans "Projetos" %}
                    </a>
                    <a href="{% url 'blog:articles' %}" class="block px-3 py-2 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md">
                        {% trans "Blog" %}
                    </a>
                    
                    <!-- Mobile Language Selector Buttons -->
                    <div class="px-3 py-2">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">{% trans "Idioma" %}</label>
                        <div class="flex items-center space-x-2">
                            <button id="mobile-lang-btn-pt" class="language-btn flex items-center px-3 py-2 rounded-lg transition-colors flex-1 justify-center {% if LANGUAGE_CODE == 'pt-br' %}bg-blue-600 text-white{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600{% endif %}" data-lang="pt-br">
                                <span class="flag-icon flag-br mr-2"></span>
                                <span class="text-sm">Português</span>
                            </button>
                            <button id="mobile-lang-btn-en" class="language-btn flex items-center px-3 py-2 rounded-lg transition-colors flex-1 justify-center {% if LANGUAGE_CODE == 'en' %}bg-blue-600 text-white{% else %}bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600{% endif %}" data-lang="en">
                                <span class="flag-icon flag-us mr-2"></span>
                                <span class="text-sm">English</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="min-h-screen">
        {% block content %}
        {% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="text-center text-gray-600 dark:text-gray-400">
                <p>&copy; 2024 {% trans "Meu Portfólio" %}. {% trans "Todos os direitos reservados" %}.</p>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script>
        // Lightsaber theme toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const desktopSaber = document.getElementById('saber-checkbox-desktop');
            const mobileSaber = document.getElementById('saber-checkbox-mobile');
            const html = document.documentElement;
            
            // Check for saved theme preference or default to light mode
            const currentTheme = localStorage.getItem('theme') || 'light';
            console.log('Current theme:', currentTheme);
            
            // Apply initial theme and saber state
            if (currentTheme === 'dark') {
                html.classList.add('dark');
                if (desktopSaber) desktopSaber.checked = true;
                if (mobileSaber) mobileSaber.checked = true;
            } else {
                html.classList.remove('dark');
                if (desktopSaber) desktopSaber.checked = false;
                if (mobileSaber) mobileSaber.checked = false;
            }
            
            // Theme toggle function
            function toggleTheme(e) {
                console.log('Lightsaber clicked!');
                
                const isChecked = e.target.checked;
                html.classList.toggle('dark', isChecked);
                const newTheme = isChecked ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                
                // Sync both sabers
                if (desktopSaber) desktopSaber.checked = isChecked;
                if (mobileSaber) mobileSaber.checked = isChecked;
                
                console.log('New theme:', newTheme);
                console.log('HTML classes:', html.className);
            }
            
            // Add change event listeners for both desktop and mobile sabers
            if (desktopSaber) {
                desktopSaber.addEventListener('change', toggleTheme);
            }
            if (mobileSaber) {
                mobileSaber.addEventListener('change', toggleTheme);
            }
            
            console.log('Lightsaber theme toggle initialized successfully');
        });
        
        // Mobile menu functionality
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            const hamburgerLine = document.querySelector('.hamburger-line');
            const closeLine = document.querySelector('.close-line');
            
            if (mobileMenuToggle && mobileMenu) {
                mobileMenuToggle.addEventListener('click', function() {
                    // Toggle menu visibility
                    mobileMenu.classList.toggle('hidden');
                    
                    // Toggle hamburger/close icon
                    hamburgerLine.classList.toggle('hidden');
                    closeLine.classList.toggle('hidden');
                });
                
                // Close mobile menu when clicking on a link
                const mobileMenuLinks = mobileMenu.querySelectorAll('a');
                mobileMenuLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        mobileMenu.classList.add('hidden');
                        hamburgerLine.classList.remove('hidden');
                        closeLine.classList.add('hidden');
                    });
                });
            }
        });
        
        // Language selector functionality
        function changeLanguage(langCode) {
            // Create a form to submit language change
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '{% url "set_language" %}';
            
            const csrfToken = document.createElement('input');
            csrfToken.type = 'hidden';
            csrfToken.name = 'csrfmiddlewaretoken';
            csrfToken.value = '{{ csrf_token }}';
            
            const langInput = document.createElement('input');
             langInput.type = 'hidden';
             langInput.name = 'language';
             langInput.value = langCode;
             
             form.appendChild(csrfToken);
             form.appendChild(langInput);
             document.body.appendChild(form);
             form.submit();
         }
         
         // Setup language buttons for both desktop and mobile
         document.addEventListener('DOMContentLoaded', function() {
             // Desktop language buttons
             const desktopPtBtn = document.getElementById('lang-btn-pt');
             const desktopEnBtn = document.getElementById('lang-btn-en');
             
             // Mobile language buttons
             const mobilePtBtn = document.getElementById('mobile-lang-btn-pt');
             const mobileEnBtn = document.getElementById('mobile-lang-btn-en');
             
             // Add click event listeners
               if (desktopPtBtn) {
                   desktopPtBtn.addEventListener('click', () => {
                       window.location.href = '/';
                   });
               }
               if (desktopEnBtn) {
                   desktopEnBtn.addEventListener('click', () => changeLanguage('en'));
               }
               if (mobilePtBtn) {
                   mobilePtBtn.addEventListener('click', () => {
                       window.location.href = '/';
                   });
               }
               if (mobileEnBtn) {
                   mobileEnBtn.addEventListener('click', () => changeLanguage('en'));
               }
         });
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>